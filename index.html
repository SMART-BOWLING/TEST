<!DOCTYPE html>
<html>
<head>
    <title>–î–µ—Ç–∞–ª–∏ - MANUALS (JSONP –≤–µ—Ä—Å–∏—è)</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .block { background: white; margin-bottom: 20px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .top-image { width: 100%; max-height: 200px; object-fit: cover; }
        .toggle-btn { width: 100%; padding: 15px; background: #1f2937; color: white; border: none; font-size: 16px; cursor: pointer; }
        .buttons-container { display: none; flex-direction: column; }
        .btn { padding: 12px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; cursor: pointer; }
        .btn:hover { background: #f0f0f0; }
        .detail-number { color: #0066cc; font-weight: bold; }
        .loading { text-align: center; padding: 40px; font-size: 18px; }
        .error { color: red; text-align: center; padding: 40px; }
        .filter-button { width: 100%; padding: 12px; background: #374151; color: white; border: none; margin-bottom: 10px; cursor: pointer; }
        .filter-dropdown { display: none; background: white; border: 1px solid #ddd; margin-bottom: 20px; }
        .filter-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .filter-item.active { background: #1f2937; color: white; }
        .filter-item:hover { background: #f0f0f0; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <button class="filter-button" onclick="toggleFilter()">üìã –§–∏–ª—å—Ç—Ä –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é</button>
    <div class="filter-dropdown" id="filterMenu">
        <div class="filter-item active" onclick="setFilter('all')">–í—Å–µ –º–∞–Ω—É–∞–ª—ã</div>
    </div>

    <div id="instructionsContainer"></div>
    <div id="loadingIndicator" class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π...</div>

    <script>
    // === –í–ê–® URL (—Ä–∞–±–æ—Ç–∞–µ—Ç) ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwXtILCyKNehFficVztcKYyvD9JBB4PK-tRx-DWXN6rHQVRROgYhqGiYy-IAe9Lw2K7kQ/exec';

    let allInstructions = [];

    // === –ó–ê–ì–†–£–ó–ö–ê –ß–ï–†–ï–ó JSONP (–†–ê–ë–û–¢–ê–ï–¢ –í –ü–ï–°–û–ß–ù–ò–¶–ï) ===
    function loadInstructions() {
        const callbackName = 'jsonp_cb_' + Date.now();
        
        window[callbackName] = function(data) {
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
            
            if (data && !data.error) {
                allInstructions = data;
                renderInstructions(data);
                updateFilterMenu(data);
            } else {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
            
            // –û—á–∏—Å—Ç–∫–∞
            delete window[callbackName];
            document.body.removeChild(script);
            document.getElementById('loadingIndicator').style.display = 'none';
        };

        const script = document.createElement('script');
        script.src = SCRIPT_URL + '?callback=' + callbackName;
        script.onerror = function() {
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL.');
            delete window[callbackName];
            document.getElementById('loadingIndicator').style.display = 'none';
        };
        
        document.body.appendChild(script);
    }

    // === –û–¢–†–ò–°–û–í–ö–ê ===
    function renderInstructions(instructions) {
        const container = document.getElementById('instructionsContainer');
        container.innerHTML = '';
        
        instructions.forEach((inst, index) => {
            const block = document.createElement('div');
            block.className = 'block';
            block.dataset.category = inst.name;
            
            // –ö–∞—Ä—Ç–∏–Ω–∫–∞
            const img = document.createElement('img');
            img.className = 'top-image';
            img.src = inst.image || 'https://via.placeholder.com/800x200?text=' + encodeURIComponent(inst.name);
            img.alt = inst.name;
            
            // –ö–Ω–æ–ø–∫–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫
            const btn = document.createElement('button');
            btn.className = 'toggle-btn';
            btn.textContent = inst.name;
            btn.onclick = () => toggleList('list-' + index);
            
            // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–µ—Ç–∞–ª–µ–π
            const list = document.createElement('div');
            list.className = 'buttons-container';
            list.id = 'list-' + index;
            
            inst.parts.forEach((part, i) => {
                const partBtn = document.createElement('div');
                partBtn.className = 'btn';
                partBtn.innerHTML = `<span>${i+1}</span><span class="detail-number">${part}</span>`;
                partBtn.onclick = (e) => {
                    if (e.target.classList.contains('detail-number')) {
                        copyToClipboard(part, e.target);
                    }
                };
                list.appendChild(partBtn);
            });
            
            block.appendChild(img);
            block.appendChild(btn);
            block.appendChild(list);
            container.appendChild(block);
        });
        
        setFilter('all');
    }

    // === –§–ò–õ–¨–¢–† ===
    function updateFilterMenu(instructions) {
        const menu = document.getElementById('filterMenu');
        const allItem = menu.children[0];
        menu.innerHTML = '';
        menu.appendChild(allItem);
        
        [...new Set(instructions.map(i => i.name))].sort().forEach(name => {
            const item = document.createElement('div');
            item.className = 'filter-item';
            item.textContent = name;
            item.onclick = () => setFilter(name);
            menu.appendChild(item);
        });
    }

    function toggleFilter() {
        const menu = document.getElementById('filterMenu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function setFilter(value) {
        document.querySelectorAll('.filter-item').forEach(item => {
            item.classList.remove('active');
            if (value === 'all' && item.textContent === '–í—Å–µ –º–∞–Ω—É–∞–ª—ã') item.classList.add('active');
            else if (item.textContent === value) item.classList.add('active');
        });
        
        document.querySelectorAll('.block').forEach(block => {
            if (value === 'all') block.classList.remove('hidden');
            else block.classList.toggle('hidden', block.dataset.category !== value);
        });
        
        document.getElementById('filterMenu').style.display = 'none';
    }

    function toggleList(id) {
        const list = document.getElementById(id);
        if (list) list.style.display = list.style.display === 'flex' ? 'none' : 'flex';
    }

    // === –ö–û–ü–ò–†–û–í–ê–ù–ò–ï ===
    async function copyToClipboard(text, element) {
        try {
            await navigator.clipboard.writeText(text);
            showCopySuccess(element);
        } catch {
            const ta = document.createElement('textarea');
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            showCopySuccess(element);
        }
    }

    function showCopySuccess(element) {
        const original = element.textContent;
        element.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        element.style.backgroundColor = '#1f2937';
        element.style.color = 'white';
        setTimeout(() => {
            element.textContent = original;
            element.style.backgroundColor = '';
            element.style.color = '';
        }, 1000);
    }

    function showError(msg) {
        document.getElementById('instructionsContainer').innerHTML = 
            `<div class="error">‚ùå ${msg}</div>`;
    }

    // === –°–¢–ê–†–¢ ===
    window.addEventListener('load', loadInstructions);
    </script>

</body>
</html>
