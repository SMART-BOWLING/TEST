<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMB | Smart Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1f2937;
            --accent: #dc143c;
            --bg: #f8fafc;
            --white: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --radius: 16px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* User Profile Bar */
        .user-bar {
            background: var(--white);
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-info img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--accent); }
        .user-details p { margin: 0; font-size: 14px; font-weight: 700; }
        .user-details span { font-size: 12px; color: var(--text-muted); }

        /* Main Grid Structure */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .action-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .action-card i {
            font-size: 32px;
            color: var(--primary);
            transition: 0.3s;
        }

        .action-card h3 { margin: 0; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }

        .action-card:hover:not(.disabled) {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }

        .action-card:hover:not(.disabled) i { color: var(--accent); }

        /* Multi-selection Menu (Dropdown) */
        .selection-menu {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--white);
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            z-index: 10;
            display: none;
            border: 1px solid #eee;
            border-top: none;
        }

        .selection-menu a {
            display: block;
            padding: 12px;
            text-decoration: none;
            color: var(--text-main);
            font-size: 14px;
            font-weight: 500;
            border-top: 1px solid #f1f5f9;
        }

        .selection-menu a:hover { background: #fff5f6; color: var(--accent); }

        .active-selection .selection-menu { display: block; }
        .active-selection { border-radius: var(--radius) var(--radius) 0 0; }

        /* Utility */
        .disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .btn-logout { background: #f1f5f9; border: none; padding: 10px; border-radius: 10px; cursor: pointer; }
        .btn-logout:hover { background: var(--accent); color: white; }

        @media (max-width: 600px) {
            .action-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="container" id="main-content" style="display:none;">
    <div class="user-bar">
        <div class="user-info">
            <img id="user-pic" src="" alt="User">
            <div class="user-details">
                <p id="user-name">Loading...</p>
                <span id="user-email">email@example.com</span>
            </div>
        </div>
        <button class="btn-logout" onclick="signOut()"><i class="fas fa-sign-out-alt"></i></button>
    </div>

    <div class="action-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="action-card" onclick="handleAction('manuals')">
            <i class="fas fa-book"></i>
            <h3>Manuals</h3>
        </div>
        <div class="action-card" onclick="handleAction('store')">
            <i class="fas fa-shopping-cart"></i>
            <h3>Store</h3>
        </div>
    </div>

    <div class="action-grid" id="category-grid">
        <div class="action-card" id="btn-parts">
            <i class="fas fa-cog"></i>
            <h3>Parts</h3>
            <div class="selection-menu" id="menu-parts"></div>
        </div>

        <div class="action-card" id="btn-maint">
            <i class="fas fa-tools"></i>
            <h3>Maintenance</h3>
            <div class="selection-menu" id="menu-maint"></div>
        </div>

        <div class="action-card" id="btn-fps">
            <i class="fas fa-chart-line"></i>
            <h3>FPS Analysis</h3>
            <div class="selection-menu" id="menu-fps"></div>
        </div>
    </div>
</div>

<script>
// Централизованная база ссылок
const DATABASE = {
    parts: {
        'Lucky Strike KH': 'https://smart-bowling.github.io/PARTS-KH/',
        'Blockbuster': 'https://smart-bowling.github.io/PARTS-BB/',
        'Skymall': 'https://smart-bowling.github.io/PARTS-SKYMALL/'
    },
    maint: {
        'Lucky Strike KH': 'https://smart-bowling.github.io/SMB-LS-KH/',
        'Blockbuster': 'https://smart-bowling.github.io/SMB-BB/',
        'Skymall': 'https://smart-bowling.github.io/SMB-SKYMALL/'
    },
    fps: {
        'Lucky Strike KH': 'https://smart-bowling.github.io/PS-STOP-KH/',
        'Blockbuster': 'https://smart-bowling.github.io/PS-STOP-BB/',
        'Skymall': 'https://smart-bowling.github.io/PS-STOP-SKYMALL/'
    }
};

// Права доступа (теперь плоские для удобства проверки)
const userPermissions = {
    'vadiksss900@gmail.com': {
        manuals: 'https://smart-bowling.github.io/MANUALS-SMART/',
        store: 'https://smart-bowling.github.io/PARTS-STORE/',
        access: {
            parts: ['Lucky Strike KH', 'Blockbuster', 'Skymall'],
            maint: ['Lucky Strike KH', 'Blockbuster', 'Skymall'],
            fps: ['Lucky Strike KH', 'Blockbuster', 'Skymall']
        }
    },
    'csportsua@gmail.com': {
        manuals: 'https://smart-bowling.github.io/MANUALS-SMART/',
        access: {
            parts: ['Skymall'],
            maint: [],
            fps: []
        }
    }
};

function handleAction(type) {
    const email = localStorage.getItem('userEmail');
    const user = userPermissions[email];
    if (user && user[type]) window.open(user[type], '_blank');
}

function initDashboard(email) {
    const user = userPermissions[email];
    const categories = ['parts', 'maint', 'fps'];

    categories.forEach(cat => {
        const btn = document.getElementById(`btn-${cat}`);
        const menu = document.getElementById(`menu-${cat}`);
        const userAccessList = user.access[cat] || [];

        if (userAccessList.length === 0) {
            btn.classList.add('disabled');
        } else if (userAccessList.length === 1) {
            // Если доступен только один объект - клик сразу ведет на ссылку
            const locationName = userAccessList[0];
            btn.onclick = () => window.open(DATABASE[cat][locationName], '_blank');
        } else {
            // Если доступно несколько - строим выпадающее меню
            btn.onclick = (e) => {
                e.stopPropagation();
                closeAllMenus();
                btn.classList.toggle('active-selection');
            };
            
            userAccessList.forEach(loc => {
                const link = document.createElement('a');
                link.href = DATABASE[cat][loc];
                link.target = "_blank";
                link.innerText = loc;
                menu.appendChild(link);
            });
        }
    });
}

function closeAllMenus() {
    document.querySelectorAll('.action-card').forEach(el => el.classList.remove('active-selection'));
}

document.addEventListener('click', closeAllMenus);

// Заглушка для демонстрации (в реальном коде используйте вашу логику Google Auth)
window.onload = function() {
    const mockEmail = 'vadiksss900@gmail.com'; // Или csportsua@gmail.com
    localStorage.setItem('userEmail', mockEmail);
    document.getElementById('main-content').style.display = 'flex';
    document.getElementById('user-email').innerText = mockEmail;
    initDashboard(mockEmail);
};

function signOut() { location.reload(); }
</script>
</body>
</html>
