<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ú–∞–Ω—É–∞–ª—ã</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* ========== –°–¢–ò–õ–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ) ========== */
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background-color: #e5e7eb;
  color: #1f2937;
  padding-top: 70px;
}
header {
  background-color: #1f2937;
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 20px;
  position: fixed;
  top:0; left:0; right:0;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  z-index:1000;
}
.logo img { width: 40px; height: 40px; object-fit: cover; }
.site-name {
  position: relative;
  flex: 1;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  color: white;
  cursor: pointer;
}
.dropdown-content {
  display: none;
  position: absolute;
  top: 220%;
  left: 50%;
  transform: translateX(-50%);
  background-color: #1f2937;
  border-radius: 6px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  min-width: 200px;
  z-index: 1001;
  flex-direction: column;
}
.dropdown-content a {
  color: white;
  padding: 10px 15px;
  text-decoration: none;
  display: block;
  text-align: center;
}
.dropdown-content a:hover { background-color: #374151; }
.search-container {
  position: relative;
}
.search-container input {
  padding: 6px 5px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
  width: 200px;
}
.search-container i {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  color: #374151;
}
.container { max-width:1200px; margin:30px auto; padding:0 20px; }
.manuals { display:grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap:20px; }
.manual {
  background:white; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:15px;
  display:flex; flex-direction:column; text-align:center; transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
}
.manual:hover { transform: translateY(-5px); box-shadow:0 5px 15px rgba(0,0,0,0.2); }
.manual h2 { margin:0 0 10px 0; font-size:18px; font-weight:600; }
.download-btn {
  background-color: #1f2937; color: white; border: none; border-radius: 6px; padding: 8px 16px;
  margin-top: 10px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.download-btn:hover { background-color: #2563eb; }
.delete-btn {
  background-color: #dc2626;
}
.delete-btn:hover { background-color: #b91c1c; }
.loading { text-align:center; padding:20px; font-size:18px; color: #666; }
.error { text-align:center; padding:20px; color:#dc2626; background:#fee2e2; border-radius:8px; margin:20px 0; }
#pdfModal {
  display: none; position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.85); z-index:10000; justify-content: center; align-items: center;
}
#pdfModal.show { display: flex; }
#pdfIframe { width: 100%; height: 100%; border: none; }
#closePdfBtn {
  position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%;
  background: rgba(220,20,60,0.9); color: white; font-size: 20px; display: flex;
  align-items: center; justify-content: center; cursor: pointer; z-index: 10001;
}
.add-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s;
  z-index: 999;
}
.add-btn:hover {
  transform: scale(1.1);
  background: #1e40af;
}
.add-form {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  z-index: 10002;
  width: 90%;
  max-width: 500px;
}
.add-form.show { display: block; }
.add-form h3 { margin-top: 0; color: #1f2937; }
.add-form input, .add-form textarea {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 16px;
  box-sizing: border-box;
}
.add-form textarea {
  resize: vertical;
  min-height: 80px;
}
.add-form button {
  padding: 12px 20px;
  margin: 10px 5px 0 0;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
}
.save-btn {
  background: #2563eb;
  color: white;
}
.cancel-btn {
  background: #e5e7eb;
  color: #374151;
}
.extract-btn {
  background: #10b981;
  color: white;
}
.extract-btn:hover {
  background: #059669;
}
.manual-meta {
  font-size: 12px;
  color: #666;
  margin-top: 5px;
}
@media (max-width: 600px) {
  .site-name { font-size: 16px; }
  .manuals { grid-template-columns:1fr; gap:15px; }
  .search-container input { width: 120px; font-size: 14px; }
}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="https://i.postimg.cc/wjGzSY92/1.png" alt="Logo"></div>
  <div class="site-name" onclick="toggleDropdown()">MANUALS
    <div class="dropdown-content" id="manualDropdown">
      <a href="#" onclick="showAddForm(); return false;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω—É–∞–ª</a>
      <a href="https://smart-bowling.github.io/PARTS-SKYMALL/#" target="_blank">SKYMALL</a>
      <a href="https://smart-bowling.github.io/PARTS-KH/" target="_blank">LUCKY STRIKE KH</a>
      <a href="https://smart-bowling.github.io/PARTS-BB/" target="_blank">BLOCKBUSTER</a>
    </div>
  </div>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –º–∞–Ω—É–∞–ª–æ–≤">
    <i class="fa-solid fa-magnifying-glass"></i>
  </div>
</header>

<div class="container">
  <div id="loading" class="loading" style="display: none;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <div class="manuals" id="container"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ PDF -->
<div id="pdfModal">
  <iframe id="pdfIframe"></iframe>
  <div id="closePdfBtn" onclick="closePDF()"><i class="fas fa-times"></i></div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<button class="add-btn" onclick="showAddForm()" title="–î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω—É–∞–ª">
  <i class="fas fa-plus"></i>
</button>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è PDF -->
<div id="addForm" class="add-form">
  <h3><i class="fas fa-file-pdf" style="color: #dc2626; margin-right: 8px;"></i> –î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω—É–∞–ª</h3>
  
  <label style="font-size: 14px; color: #374151;">–°—Å—ã–ª–∫–∞ –Ω–∞ PDF:</label>
  <input type="url" id="pdfUrl" placeholder="https://res.cloudinary.com/... .pdf" onchange="autoExtractTitle()" onpaste="setTimeout(autoExtractTitle, 100)">
  
  <label style="font-size: 14px; color: #374151; margin-top: 10px; display: block;">
    –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–Ω—É–∞–ª–∞:
    <span style="font-weight: normal; color: #666; margin-left: 8px;">
      <i class="fas fa-magic" style="color: #10b981;"></i> –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    </span>
  </label>
  <textarea id="pdfName" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ-–Ω–∞–∑–≤–∞–Ω–∏—è"></textarea>
  
  <div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <button class="extract-btn" onclick="extractTitleFromUrl()" type="button">
      <i class="fas fa-magic"></i> –ò–∑–≤–ª–µ—á—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ —Å—Å—ã–ª–∫–∏
    </button>
    <button class="extract-btn" onclick="extractTitleFromPdf()" type="button" id="extractPdfBtn">
      <i class="fas fa-file-pdf"></i> –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ PDF
    </button>
  </div>
  
  <div style="margin-top: 20px;">
    <button class="save-btn" onclick="addManual()">
      <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    </button>
    <button class="cancel-btn" onclick="hideAddForm()">
      <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
    </button>
  </div>
  
  <div id="pdfPreview" style="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 6px; display: none;">
    <span id="previewText"></span>
  </div>
</div>

<script>
// ------------------------------------------------------------
// ‚ö° –ù–ê–ß–ê–õ–¨–ù–´–ï PDF –§–ê–ô–õ–´ ‚ö°
// ------------------------------------------------------------
const INITIAL_PDFS = [
    {
        name: "XLi Pinspotter Motor & Gearbox Manual Rev.F",
        url: "https://res.cloudinary.com/dplmdnxvk/image/upload/v1770733764/wfxcpkcdfppfeoybxxx2.pdf",
        added: "2024-01-15"
    }
];

// ------------------------------------------------------------
// –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ù–ê–ó–í–ê–ù–ò–Ø
// ------------------------------------------------------------

// 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–∑ URL
function extractTitleFromUrl() {
    const url = document.getElementById('pdfUrl').value.trim();
    if (!url) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PDF');
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ URL
    let fileName = url.split('/').pop();
    
    // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Å–ª–µ .pdf
    fileName = fileName.split('?')[0];
    
    // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .pdf
    let title = fileName.replace('.pdf', '');
    
    // –ó–∞–º–µ–Ω—è–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –Ω–∞ –ø—Ä–æ–±–µ–ª—ã
    title = title
        .replace(/_/g, ' ')
        .replace(/-/g, ' ')
        .replace(/\+/g, ' ')
        .replace(/%20/g, ' ')
        .replace(/[0-9]+$/, ''); // —É–±–∏—Ä–∞–µ–º —Ü–∏—Ñ—Ä—ã –≤ –∫–æ–Ω—Ü–µ
    
    // –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—É—é –±—É–∫–≤—É –∑–∞–≥–ª–∞–≤–Ω–æ–π
    title = title.charAt(0).toUpperCase() + title.slice(1);
    
    // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞ "wfxcpkcdfppfeoybxxx2" - –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ
    if (title.length < 5 || /^[a-z0-9]+$/i.test(title)) {
        title = "–ú–∞–Ω—É–∞–ª " + new Date().toLocaleDateString();
    }
    
    document.getElementById('pdfName').value = title;
    showPreview('–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ —Å—Å—ã–ª–∫–∏: ' + title);
}

// 2. –ß—Ç–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–∑ —Å–∞–º–æ–≥–æ PDF —Ñ–∞–π–ª–∞
async function extractTitleFromPdf() {
    const url = document.getElementById('pdfUrl').value.trim();
    if (!url) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PDF');
        return;
    }
    
    const btn = document.getElementById('extractPdfBtn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ß–∏—Ç–∞–µ–º PDF...';
    btn.disabled = true;
    
    try {
        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü PDF
        const title = await fetchPdfTitle(url);
        
        if (title) {
            document.getElementById('pdfName').value = title;
            showPreview('‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ –≤ PDF: ' + title);
        } else {
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º URL
            extractTitleFromUrl();
            showPreview('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å PDF, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ —Å—Å—ã–ª–∫–∏');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è PDF:', error);
        extractTitleFromUrl();
        showPreview('‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è PDF, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ —Å—Å—ã–ª–∫–∏');
    } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è PDF –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
async function fetchPdfTitle(pdfUrl) {
    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(pdfUrl);
        const response = await fetch(proxyUrl);
        
        if (!response.ok) return null;
        
        const pdfData = await response.arrayBuffer();
        
        // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ PDF –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        const text = new TextDecoder('latin1').decode(pdfData.slice(0, 50000)); // —á–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–µ 50KB
        
        // –ò—â–µ–º Title –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        const titleMatch = text.match(/\/Title\s*\(([^)]+)\)/i) || 
                          text.match(/\/Title\s*<([^>]+)>/i) ||
                          text.match(/Title:\s*([^\n\r]+)/i);
        
        if (titleMatch) {
            return titleMatch[1].trim();
        }
        
        // –ò—â–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Ç–µ–∫—Å—Ç–∞
        const lines = text.split('\n');
        for (let line of lines) {
            line = line.trim();
            if (line.length > 10 && line.length < 100 && !line.includes('http') && !line.includes('PDF')) {
                return line;
            }
        }
        
        return null;
    } catch (e) {
        console.error('Error reading PDF:', e);
        return null;
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏
function autoExtractTitle() {
    const url = document.getElementById('pdfUrl').value.trim();
    const nameField = document.getElementById('pdfName');
    
    // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—É—Å—Ç–æ–µ
    if (nameField.value.trim() === '' && url) {
        extractTitleFromUrl();
    }
}

// –ü–æ–∫–∞–∑ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
function showPreview(text) {
    const preview = document.getElementById('pdfPreview');
    const previewText = document.getElementById('previewText');
    previewText.textContent = text;
    preview.style.display = 'block';
    
    setTimeout(() => {
        preview.style.display = 'none';
    }, 5000);
}

// ------------------------------------------------------------
// –†–ê–ë–û–¢–ê –° –•–†–ê–ù–ò–õ–ò–©–ï–ú
// ------------------------------------------------------------

// –ó–∞–≥—Ä—É–∑–∫–∞ PDF –∏–∑ localStorage
function loadPDFs() {
    const stored = localStorage.getItem('manuals_pdfs');
    if (stored) {
        return JSON.parse(stored);
    }
    // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ PDF
    localStorage.setItem('manuals_pdfs', JSON.stringify(INITIAL_PDFS));
    return INITIAL_PDFS;
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PDF –≤ localStorage
function savePDFs(pdfs) {
    localStorage.setItem('manuals_pdfs', JSON.stringify(pdfs));
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö PDF
function renderManuals() {
    const container = document.getElementById('container');
    const pdfs = loadPDFs();
    
    container.innerHTML = '';
    
    if (pdfs.length === 0) {
        container.innerHTML = '<div class="error">üì≠ –ù–µ—Ç –º–∞–Ω—É–∞–ª–æ–≤. –ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å!</div>';
        return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    pdfs.sort((a, b) => {
        if (a.added && b.added) {
            return b.added.localeCompare(a.added);
        }
        return 0;
    });
    
    pdfs.forEach((pdf, index) => {
        const card = document.createElement('div');
        card.className = 'manual';
        
        let metaHtml = '';
        if (pdf.added) {
            const date = new Date(pdf.added);
            metaHtml = `<div class="manual-meta">üìÖ ${date.toLocaleDateString()}</div>`;
        }
        
        card.innerHTML = `
            <h2>${pdf.name}</h2>
            ${metaHtml}
            <div style="display: flex; gap: 8px; justify-content: center; margin-top: 5px;">
                <button class="download-btn" onclick="event.stopPropagation(); downloadPDF('${pdf.url}', '${pdf.name}.pdf')">
                    <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å
                </button>
                <button class="download-btn delete-btn" onclick="event.stopPropagation(); deleteManual(${index})">
                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        `;
        card.onclick = () => openPDF(pdf.url);
        container.appendChild(card);
    });
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞–Ω—É–∞–ª–∞
async function addManual() {
    const urlInput = document.getElementById('pdfUrl');
    const nameInput = document.getElementById('pdfName');
    
    let url = urlInput.value.trim();
    let name = nameInput.value.trim();
    
    if (!url) {
        alert('‚ùå –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PDF');
        return;
    }
    
    if (!url.toLowerCase().endsWith('.pdf')) {
        alert('‚ùå –°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ .pdf');
        return;
    }
    
    // –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –ø—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    if (!name) {
        await extractTitleFromPdf();
        name = nameInput.value.trim();
        
        // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –ø—É—Å—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É
        if (!name) {
            name = `–ú–∞–Ω—É–∞–ª ${new Date().toLocaleDateString()}`;
        }
    }
    
    const pdfs = loadPDFs();
    pdfs.push({
        name: name,
        url: url,
        added: new Date().toISOString().split('T')[0]
    });
    
    savePDFs(pdfs);
    
    urlInput.value = '';
    nameInput.value = '';
    hideAddForm();
    renderManuals();
}

// –£–¥–∞–ª–µ–Ω–∏–µ –º–∞–Ω—É–∞–ª–∞
function deleteManual(index) {
    if (confirm('üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞–Ω—É–∞–ª?')) {
        const pdfs = loadPDFs();
        pdfs.splice(index, 1);
        savePDFs(pdfs);
        renderManuals();
    }
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
function downloadPDF(url, filename) {
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    link.click();
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ PDF
function openPDF(url) {
    const modal = document.getElementById('pdfModal');
    const iframe = document.getElementById('pdfIframe');
    iframe.src = `https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(url)}#zoom=page-width`;
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closePDF() {
    const modal = document.getElementById('pdfModal');
    const iframe = document.getElementById('pdfIframe');
    modal.classList.remove('show');
    document.body.style.overflow = 'auto';
    setTimeout(() => { iframe.src = ''; }, 300);
}

// –ü–æ–∏—Å–∫
document.getElementById('searchInput').addEventListener('input', function() {
    const search = this.value.toLowerCase();
    document.querySelectorAll('.manual').forEach(manual => {
        const title = manual.querySelector('h2').textContent.toLowerCase();
        manual.style.display = title.includes(search) ? '' : 'none';
    });
});

// UI —Ñ—É–Ω–∫—Ü–∏–∏
function toggleDropdown() {
    const dropdown = document.getElementById('manualDropdown');
    dropdown.style.display = dropdown.style.display === 'flex' ? 'none' : 'flex';
}

window.addEventListener('click', function(e){
    const siteName = document.querySelector('.site-name');
    const dropdown = document.getElementById('manualDropdown');
    if(!siteName.contains(e.target)) dropdown.style.display='none';
});

function showAddForm() {
    document.getElementById('addForm').classList.add('show');
    document.getElementById('manualDropdown').style.display = 'none';
    document.getElementById('pdfUrl').value = '';
    document.getElementById('pdfName').value = '';
}

function hideAddForm() {
    document.getElementById('addForm').classList.remove('show');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    renderManuals();
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closePDF();
        hideAddForm();
    }
});
</script>
</body>
</html>
