<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MANUALS</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background-color: #ffffff;
  color: #1f2937;
  padding-top: 70px;
}

/* HEADER */
header {
  background-color: #1f2937;
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 20px;
  position: fixed;
  top:0; left:0; right:0;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  user-select: none;
  z-index:1000;
}

.logo img {
  width:40px;
  height:40px;
  object-fit:cover;
}

.site-name {
  position:relative;
  flex:1;
  text-align:center;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}

.dropdown-content {
  display:none;
  position:absolute;
  top:200%;
  left:50%;
  transform:translateX(-50%);
  background:#1f2937;
  border-radius:6px;
  min-width:180px;
  flex-direction:column;
}

.dropdown-content a {
  color:white;
  padding:8px 12px;
  text-decoration:none;
  text-align:center;
  font-size:14px;
}

.dropdown-content a:hover {
  background:#374151;
}

.search-container {
  position:relative;
}

.search-container input {
  padding:6px 30px 6px 10px;
  border-radius:6px;
  border:none;
  font-size:16px;
  width:180px;
}

.search-container i {
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  color:#374151;
}

/* FILTER */
.filter-button {
  background:#374151;
  color:white;
  padding:10px 20px;
  font-size:16px;
  border:none;
  width:100%;
  text-align:left;
  cursor:pointer;
  display:flex;
  gap:10px;
  align-items:center;
}

.filter-dropdown {
  display:none;
  background:#fff;
  border-bottom:1px solid #ddd;
}

.filter-item {
  padding:12px 16px;
  border-top:1px solid #eee;
  cursor:pointer;
}

.filter-item:hover {
  background:#f3f4f6;
}

.filter-item.active {
  background:#1f2937;
  color:white;
}

/* BLOCK */
.block.hidden { display:none; }

.top-image {
  width:100%;
  max-height:300px;
  object-fit:cover;
}

.toggle-btn {
  width:100%;
  padding:14px;
  font-size:16px;
  font-weight:600;
  background:#1f2937;
  color:#fff;
  border:none;
  cursor:pointer;
}

.buttons-container {
  display:none;
  flex-direction:column;
}

.btn {
  display:flex;
  justify-content:space-between;
  padding:13px 16px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
}

.btn:hover { background:#f9fafb; }

.highlight {
  background:#ffe4e6 !important;
  border-color:#dc143c !important;
}

.copy-success {
  background:#1f2937 !important;
  color:white !important;
}

.detail-info {
  overflow:hidden;
  max-height:0;
  opacity:0;
  transition:0.4s;
  background:#fff;
  border-left:3px solid #dc143c;
}

.detail-info.open {
  max-height:200px;
  opacity:1;
}

.club-row {
  display:flex;
  justify-content:space-between;
  padding:10px 16px;
  border-top:1px solid #eee;
}

.count-zero { color:#dc143c; }
.count-positive { color:#16a34a; }

</style>
</head>
<body>

<header>
  <div class="logo">
    <img src="https://i.postimg.cc/wjGzSY92/1.png">
  </div>

  <div class="site-name" onclick="toggleDropdown()">MANUALS
    <div class="dropdown-content" id="manualDropdown">
      <a href="https://smart-bowling.github.io/PARTS-SKYMALL/" target="_blank">SKYMALL</a>
      <a href="https://smart-bowling.github.io/PARTS-KH/" target="_blank">LUCKY STRIKE KH</a>
      <a href="https://smart-bowling.github.io/PARTS-BB/" target="_blank">BLOCKBUSTER</a>
    </div>
  </div>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Поиск детали">
    <i class="fa-solid fa-magnifying-glass"></i>
  </div>
</header>

<button class="filter-button" onclick="toggleFilter()">
  <i class="fa-solid fa-filter"></i> Фильтр по оборудованию
</button>

<div class="filter-dropdown" id="filterMenu"></div>

<div id="manualContainer"></div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzHkkjF3Si6WzhVQVNMc9kvexvnsJNC_s8VVZsgjr3YeheetPKvY2vRzw8uHgL8S99VSg/exec";

let manualsData = [];

/* LOAD DATA */
async function loadManuals(){
  const response = await fetch(API_URL);
  manualsData = await response.json();
  renderManuals(manualsData);
  buildFilter(manualsData);
}

/* RENDER */
function renderManuals(manuals){
  const container = document.getElementById("manualContainer");
  container.innerHTML="";

  manuals.forEach(manual=>{

    const block=document.createElement("div");
    block.className="block";
    block.dataset.category=manual.name.toLowerCase();

    block.innerHTML=`
      <img class="top-image" src="${manual.image}">
      <button class="toggle-btn">${manual.name}</button>
      <div class="buttons-container"></div>
    `;

    const btnContainer=block.querySelector(".buttons-container");

    manual.parts.forEach((part,i)=>{
      const btn=document.createElement("div");
      btn.className="btn";
      btn.dataset.number=part.toLowerCase();

      btn.innerHTML=`
        <span>${i+1}</span>
        <span class="detail-number">${part}</span>
      `;

      btn.addEventListener("click",(e)=>{
        if(e.target.classList.contains("detail-number")){
          copyToClipboard(part,e.target);
          e.stopPropagation();
        }else{
          toggleDetail(btn);
        }
      });

      btnContainer.appendChild(btn);
    });

    block.querySelector(".toggle-btn")
      .addEventListener("click",()=>{
        btnContainer.style.display=
          btnContainer.style.display==="flex"?"none":"flex";
      });

    container.appendChild(block);
  });
}

/* FILTER BUILD AUTO */
function buildFilter(manuals){
  const menu=document.getElementById("filterMenu");
  menu.innerHTML=`<div class="filter-item active" onclick="setFilter('all')">Все мануалы</div>`;

  manuals.forEach(manual=>{
    menu.innerHTML+=`
      <div class="filter-item" onclick="setFilter('${manual.name.toLowerCase()}')">
        ${manual.name}
      </div>
    `;
  });
}

/* FILTER */
function toggleFilter(){
  const menu=document.getElementById("filterMenu");
  menu.style.display=menu.style.display==="block"?"none":"block";
}

function setFilter(value){
  document.querySelectorAll(".filter-item")
    .forEach(i=>i.classList.remove("active"));

  event.target.classList.add("active");

  document.querySelectorAll(".block").forEach(block=>{
    if(value==="all"){
      block.classList.remove("hidden");
    }else{
      block.classList.toggle(
        "hidden",
        block.dataset.category!==value
      );
    }
  });

  document.getElementById("filterMenu").style.display="none";
}

/* SEARCH */
function searchDetail(){
  const value=document.getElementById("searchInput")
    .value.trim().toLowerCase();

  document.querySelectorAll(".btn").forEach(btn=>{
    btn.classList.remove("highlight");
    if(btn.dataset.number.includes(value) && value.length>1){
      btn.classList.add("highlight");
      btn.closest(".buttons-container").style.display="flex";
    }
  });
}

document.getElementById("searchInput")
  .addEventListener("input",searchDetail);

/* DROPDOWN */
function toggleDropdown(){
  const d=document.getElementById("manualDropdown");
  d.style.display=d.style.display==="flex"?"none":"flex";
  d.style.flexDirection="column";
}

window.addEventListener("click",(e)=>{
  if(!document.querySelector(".site-name").contains(e.target)){
    document.getElementById("manualDropdown").style.display="none";
  }
});

/* COPY */
async function copyToClipboard(text,el){
  try{
    await navigator.clipboard.writeText(text);
    showCopySuccess(el);
  }catch{
    alert("Ошибка копирования");
  }
}

function showCopySuccess(el){
  const orig=el.textContent;
  el.textContent="✓ Скопировано!";
  el.classList.add("copy-success");
  setTimeout(()=>{
    el.textContent=orig;
    el.classList.remove("copy-success");
  },1000);
}

/* DETAIL INFO */
function toggleDetail(button){
  if(button.nextElementSibling &&
     button.nextElementSibling.classList.contains("detail-info")){
    button.nextElementSibling.remove();
    return;
  }

  const info=document.createElement("div");
  info.className="detail-info";

  const data=[
    {name:"BLOCKBUSTER",count:7},
    {name:"LUCKY STRIKE KH",count:0},
    {name:"SKYMALL",count:4}
  ];

  data.forEach(club=>{
    info.innerHTML+=`
      <div class="club-row">
        <span>${club.name}</span>
        <span class="${club.count===0?'count-zero':'count-positive'}">
          ${club.count} шт.
        </span>
      </div>
    `;
  });

  button.after(info);
  setTimeout(()=>info.classList.add("open"),10);
}

loadManuals();

</script>
</body>
</html>
